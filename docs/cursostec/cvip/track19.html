<html><head>
<title>CVip_track19</title>
<style type="text/css">

.dica {	width:500pt; background:aliceblue;color:#700080}
span {
font-family: 'Courier New';
font-size: 10pt;
color: #000000;
}
.sc0 {
}


.sc1 {
color: darkgreen;
font-weight: bold;
}

.sntx {
color: darkgreen;
}


.sc2 {
color: #008000;
}
.sc4 {
color: #ff8000;
}
.sc5 {
font-weight: bold;
color: #0000FF;
}
.sc6 {
color: #FF0000;
}
.sc9 {
color: #804000;
font-weight: bold;
}
.sc10 {
font-weight: bold;
color: #000080;
}
.sc11 {
}
.sc16 {
color: #400080;
}

.prg {
color: #0000FF;
}

.prg-saida {

margin-left:0px;
width:500pt;
background-color:lightblue;

}

.prg-code {
margin-left:0px;
width:500pt;
background-color:lightyellow;
padding:10px;
font-weight:bold;
}


.niceview {
margin-left:0px;
width:500pt;
background-color:white;
border-color:lightgray;
border-width:1px;
border-style:solid;
padding:10px;
}

td
{
padding:3px;
}

table.dados
{

margin-left:0px;
width:53.5em;
border-collapse:collapse;
border:1px solid red;
text-align:center;
}

th
{
background-color:darkgreen;
color:yellow;
font-weight:bold;
text-transform:uppercase;
}
body
{
margin-left:60px;
}
.pagebody
{
margin-left:50px;
border-width:1px;
border-style:solid;
border-color:white;
background-color:white;
width:90%;
-webkit-border-radius: 40px 40px 40px 40px;
-moz-border-radius: 40px 40px 40px 40px;
border-radius: 15px 15px 15px 15px;
}
.mybody
{
margin-top:20pt;
margin-bottom:20pt;
margin-left:20pt;
margin-right:20pt;
/* border-width:1px; */
/* border-style:solid; */
border-color:lightgray;
background-image:url('backdrop.jpg');
}
</style>
</head>
<body class=mybody><font color="black">
<div class=pagebody>
<hr>
<center><b style="font-size:1.5em;" >Curso completo de linguagem C</b><br>
Gameprog - Escola de programação de jogos digitais<br>
Contato: gameprog.br@gmail.com<br>
<b>track19.html</b></center>
<hr>
<table align=bottom border=0 cellspacing=0 cellpadding=0 width=20%><tr>
<td><a href=cvip.html style='color:blue'> index </a></td><td><a href='track18.html'style='color:blue'>&lt;&lt;</a></td>
<td><a href='track20.html'style='color:blue'>&gt;&gt;</a></td></tr></table>
<hr><pre>
<a name="track19"></a><h3 style="background-color:#80ff80">19. #Diretivas de compilação</h3>
<b style="background-color:lightgreen">19.1 Visão geral</b>

Existem instruções da linguagem C denominadas <b>diretivas de compilação</b>,
como  exemplo  citamos  <span class=prg>#include</span>  que  usamos  para  incluir arquivos
externos  no  nosso  programa.  Estas  diretivas  são precedidas pelo
carácter  sharp  ou  cerquilha  (<span class=prg>#</span>)  e  o  final  das suas linhas não
terminam com ponto-e-vírgula ( <b class=prg>;</b> ).

A função das diretivas é orientar o compilador na  montagem do código
final. Através das diretivas podemos determinar se certas  partes  do
nosso  programa  serão  compiladas  ou  não; como  exemplo, citamos a
situação na qual vamos habilitar ou  desabilitar  alguns  recursos do
nosso programa conforme a distribuição dele  seja uma demonstração ou
a versão comercial final.

Outro  uso  bastante  explorado  das  diretivas  é  o  seu  uso  como
constantes. Você pode definir que MAX_TAMANHO vai  ser  igual  a  260,
ao longo do seu programa você pode usar  MAX_TAMANHO para  se referir
ao  valor 260; durante o processo de compilação  toda  ocorrência  de
MAX_TAMANHO é substituída literalmente pelo  valor  260. O uso destas
definições  constantes  acelera  a  execução  do código pois gasta-se
tempo  acessando  as  posições  de  memória das variáveis. Destacamos
também  que  o  código  fica  mais  legível.

Com  as  diretivas  também  é  possível  definir pequenas fórmulas ou
equações  que  geram  valores  constantes  como  resultado  final  de
sua avaliação.

Veja o elenco das diretivas que vamos estudar:
	
<table class=dados border=1>
<tr><th>Diretiva</th><th>Função</th></tr>
<tr class=gray><td>#include</td><td> Incluir arquivo externo<br></td></tr>
<tr><td>#define</td><td> Cria uma constante<br></td></tr>
<tr class=gray><td>#undef</td><td> Apaga uma constante criada<br></td></tr>
<tr><td>#ifdef <br>(...)<br> #endif</td><td> Compilação condicional</td></tr>
<tr class=gray><td>#ifndef<br>(...)<br> #endif</td><td> Compilação condicional</td></tr>
<tr><td>#if<br>(...)<br> #else/#elif<br>(...)<br> #endif</td><td> Compilação condicional</td></tr>
</table>

<b style="background-color:lightgreen">19.2 #include </b>

A diretiva <b>#include</b> é usada para incluir um arquivo externo em nosso
programa; este arquivo pode ser um arquivo de cabeçalho ou  um outro
programa na linguagem C.

Sua sintaxe geral de uso é esta:<b style="color:green">

#include &lt;arquivo.h&gt;
#include "arquivo.h"</b>

O  primeiro  uso &lt;arquivo.h&gt;  indica que o arquivo deve ser procurado
procurado  no  diretório  INCLUDE.  Usamos  as  aspas quando queremos
indicar  que  o  arquivo  está  no diretório corrente ou  no  caminho
especificado.


<b style="background-color:lightgreen">19.3 #define </b>

Esta  diretiva  é  usada  para  definir valores constantes e pequenas
equações   que   vão   gerar  uma  constante  final  como  resultado.

Sua sintaxe geral é <b style="color:green">#define NOME_CONSTANTE nValor</b>

<b>NOME_CONSTANTE</b> representa um nome qualquer que você  pode dar  a  sua
constante usando as mesmas regras usadas na  definição  do  nome  das
variáveis. Há o costume generalizado de definir o nome das constantes
sempre em letras maiúsculas.

<b>nValor</b> representa o valor da sua constante.  Repare nas ausências do
sinal  de  igual  e  do  sinal  de final de linha da linguagem C (;).

Ex.:<font color="darkblue">
#define NULL         0
#define SEEK_CUR     1
#define TMP_MAX      0xFFFF</font>

Acima   estão   algumas  constantes  definidas  no  arquivo  stdio.h.
O   valor  da  constante  TMP_MAX  está  definido  na  base  numérica
hexadecimal que é identificada pelo préfixo <b>0x</b>. Você pode usar a base
hexadecimal para definir valores de variáveis e das  constantes  como
você viu acima.

<u>#define NOME_CONSTANTE - DEFININDO SIMPLESMENTE UMA CONSTANTE</u>
Você  pode  simplesmente  definir  uma  constante sem atribuir nenhum
valor  a  mesma.  Posteriormente  você  pode condicionar a compilação
de  certas  partes  do  seu  código conforme a constante foi definida
ou não.

Exemplo:<font color="darkblue">

#define DEBUG

#ifdef DEBUG
printf("Código da versão em debug\n");
#endif

#ifndef DEBUG
printf("Código da versão final\n");
#endif</font>

<b class=prg>#ifdef</b>    compila   o   código   se   a   constante   foi   definida.
<b class=prg>#ifndef</b>   compila   o   código  se  a  constante  não  foi  definida.

<u>#define FORMULA(x) - DEFININDO UMA FÓRMULA OU EQUAÇÃO</u>

Esta sintaxe de #define é desta forma:<b style="color:green">

#define FORMULA(x) (Cálculo com os argumentos x entre parêntesis)</b>

Ex.:<font color="darkblue">

#define DOBRO(x)        ((x) * 2)

printf("O dobro de 256 é %i \n",DOBRO(256));</font>

Resulta em:
O dobro de 256 é 512

O valor 256 foi substituído literalmente por 512 na compilação final.

A  definição  e  uso  da  fórmula  é semelhante ao das funções, com a
exceção   de  que  os  argumentos  devem  estar  rigorosamente  entre
parêntesis na parte do cálculo.

<b style="background-color:lightgreen">19.4 #undef </b>

<b style="color:green">#undef NOMECONSTANTE</b>
<font color="darkblue">
#undef DEBUG</font>

Esta  diretiva  apaga  a  constante  citada, num termo esquisito, ela
desdefine a constante criada com #define.

<b style="background-color:lightgreen">19.5 #ifdef...#else...#endif</b>
<b style="color:green">
#ifdef NOMECONSTANTE
código;
	#else
	código;
#endif</b>

#ifdef compila o código caso a constante NOMECONSTANTE  foi definida,
no caso contrário o bloco  que  segue  <b>#else</b>  é compilado;  #else  é
opcional e <b>#endif</b> fecha obrigatoriamente o bloco.

A lógica de uso é a mesma usada  com as instruções if..else  normais.

Ao  invés  de  #ifdef  você  pode  usar  a  sintaxe  equivalente
<b>#if defined(NOMECONSTANTE)</b> que é uma sintaxe desdobrada.


<b style="background-color:lightgreen">19.6 #ifndef...#endif</b>
<b style="color:green">
#ifndef NOMECONSTANTE
código;
#endif</b>

#ifndef  compila  o  código  caso  a  constante NOMECONSTANTE <b>não</b> foi
definida; #else é opcional e <b>#endif</b> fecha obrigatoriamente  o  bloco.

A lógica de uso é a mesma usada  com as instruções if..else  normais.

Ao   invés   de   #ifndef   você  pode  usar  a  sintaxe  equivalente
<b>#if !defined(NOMECONSTANTE)</b>  que  é  uma  sintaxe  desdobrada.


<b style="background-color:lightgreen">19.7 #if..#else...#elif...#endif</b>

<b style="color:green"><div class=niceview>
#if (CONSTANTE == nValor)
código;

#else
código;

#endif

#if (CONSTANTE == nValor)
código;

	#elif (CONSTANTE == nValor)
	código;
	
	#elif (CONSTANTE == nValor)
	código;

#endif</b>
<br></div>

O bloco de código é compilado <b>se</b> a condição  envolvendo  a  CONSTANTE
apresentar-se  como  verdadeira.  A  sua  lógica e sintaxe de uso é a
mesma  usada  nas  instruções  <b>if, else e else if</b>  normais.

<b>#elif</b> tem o significado e efeito de <b>#else if</b>
Como sempre, veja o programa exemplo:
	
<div class=prg-saida>
 <img src=images\diretiv.png>
<br></div>
<div class=prg-code>
<span class="sc1">/* Programa: diretiv.c track 19            */</span><span class="sc0">
</span><span class="sc1">/* Testando diretivas de compilação        */</span><span class="sc0">
</span><span class="sc9">#include "stdio.h"
#include "stdlib.h"
</span><span class="sc0">
</span><span class="sc1">/* ----- Definição das constantes ---------------------------- */</span><span class="sc0">
</span><span class="sc9">#define     TESTE
#define     XTESTE  12
#define     DOBRO(x) ((x) * 2)
</span><span class="sc0">
</span><span class="sc1">/* Protótipos */</span><span class="sc0">
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">initSys</span><span class="sc10">(</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">title</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">main</span><span class="sc10">(</span><span class="sc16">void</span><span class="sc10">)</span><span class="sc0">  
</span><span class="sc10">{</span><span class="sc0">
</span><span class="sc11">initSys</span><span class="sc10">(</span><span class="sc6">"title diretiv.c"</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc1">/* ------------------ Teste de #ifdef/#else/#endif ----------- */</span><span class="sc0">
</span><span class="sc9">#ifdef TESTE
</span><span class="sc11">printf</span><span class="sc10">(</span><span class="sc6">" A constante TESTE foi definida\n\n"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc9">#else
</span><span class="sc11">printf</span><span class="sc10">(</span><span class="sc6">" A constante TESTE nao foi definida\n"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc9">#endif
</span><span class="sc0">
</span><span class="sc1">/* ------------------ Teste de #ifndef/#else/#endif ---------- */</span><span class="sc0">
</span><span class="sc9">#ifndef TESTE
</span><span class="sc11">printf</span><span class="sc10">(</span><span class="sc6">" A constante TESTE nao foi definida ou foi apagada\n"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc9">#endif
</span><span class="sc0">
</span><span class="sc1">/* ------------------ Teste de #ifndef/#else ---------------- */</span><span class="sc0">
</span><span class="sc9">#ifndef TESTE
</span><span class="sc11">printf</span><span class="sc10">(</span><span class="sc6">"\n\n Testando #undef ifndef...\n"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">printf</span><span class="sc10">(</span><span class="sc6">" A constante TESTE nao foi definida ou foi apagada\n"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc9">#else
</span><span class="sc11">printf</span><span class="sc10">(</span><span class="sc6">" Testando #define #ifndef #else...\n\n"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc9">#endif
</span><span class="sc0">

</span><span class="sc1">/* ------------------ Teste de #elif ----------------------- */</span><span class="sc0">
</span><span class="sc9">#if (XTESTE == 10)
</span><span class="sc11">printf</span><span class="sc10">(</span><span class="sc6">" XTESTE == 10\n"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc9">#elif (XTESTE == 12)
</span><span class="sc11">printf</span><span class="sc10">(</span><span class="sc6">" XTESTE == 12 (true) Testando #if\\#elif\n\n"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc9">#endif
</span><span class="sc0">

</span><span class="sc1">/* --------- Teste de #define DOBRO(x) ((x) * 2)  ---------- */</span><span class="sc0">
</span><span class="sc11">printf</span><span class="sc10">(</span><span class="sc6">" Dobro de 256: %i\n\n"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">DOBRO</span><span class="sc10">(</span><span class="sc4">256</span><span class="sc10">));</span><span class="sc0">


</span><span class="sc1">/* ------------------ Teste de #if defined()  -------------- */</span><span class="sc0">
</span><span class="sc9">#if defined(TESTE)
</span><span class="sc11">printf</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc6">" #if defined() ok \n\n"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc9">#endif
</span><span class="sc0">
</span><span class="sc1">/* ------------------ Apaga TESTE  ------------------------- */</span><span class="sc0">
</span><span class="sc9">#undef TESTE
</span><span class="sc0">
</span><span class="sc1">/* ------------------ Teste de #if !defined()  ------------- */</span><span class="sc0">
</span><span class="sc9">#if !defined(TESTE)
</span><span class="sc11">printf</span><span class="sc10">(</span><span class="sc6">" #if !defined() ok \n\n"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc9">#endif
</span><span class="sc0">
</span><span class="sc11">getchar</span><span class="sc10">();</span><span class="sc0">
</span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc1">/* ------------------ Função initSys()  -------------------- */</span><span class="sc0">
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">initSys</span><span class="sc10">(</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">title</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
</span><span class="sc1">/* Configura a janela */</span><span class="sc0">
</span><span class="sc11">system</span><span class="sc10">(</span><span class="sc11">title</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">system</span><span class="sc10">(</span><span class="sc6">"color F1"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">printf</span><span class="sc10">(</span><span class="sc6">"\n\n"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0"></div>


<b style="background-color:lightgreen">19.8 Conteúdo duplicado</b>

Existe o risco de uma aplicação complexa incluir várias vezes o mesmo 
arquivo.  Para  evitar esse risco você vai perceber  que  existe  nos 
arquivos de cabeçalho a  seguinte  construção  com  as  diretivas  de
compilação:
<b class=prg>
#ifndef _STDLIB_H_
	#define _STDLIB_H_
	/* conteúdo do arquivo */
#endif
</b>
Essa construção pertence ao arquivo stdlib.h e evita que esse arquivo
seja incluido outras vezes por  uma  mesma  aplicação.  Utilize  essa
construção nos seus arquivos de cabeçalho para evitar  problemas  com
duplicação de conteúdo.
<hr>
<table align=bottom border=0 cellspacing=0 cellpadding=0 width=20%><tr><td><a href=cvip.html style='color:blue'> index </a></td><td><a href='track18.html'style='color:blue'>&lt;&lt;</a></td><td><a href='track20.html'style='color:blue'>&gt;&gt;</a></td></tr></table><hr><div style='background-color:lightyellow;color:blue'>
<center>Produzido por Gameprog: Jair Pereira - Fev/2006 - Junho/2013 ©
gameprog.br@gmail.com
<a href='http://www.gameprog.com.br'>http://www.gameprog.com.br</a></center><hr></div></div></body></html>
