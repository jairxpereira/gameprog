<html>
<head>
<title>DarkGdk_fase15.2</title>
<head>
<style type="text/css">

span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}


.sc1 {
	color: darkgreen;
	font-weight: bold;
}

.sntx {
	color: darkgreen;
	}


.sc2 {
	color: #008000;
}
.sc4 {
	color: #ff8000;
}
.sc5 {
	font-weight: bold;
	color: #0000FF;
}
.sc6 {
	color: #FF0000;
}
.sc9 {
	color: #804000;
	font-weight: bold;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc11 {
}
.sc16 {
	color: #400080;
}

.prg {
	color: #0000FF;
}

.prg-saida {

	margin-left:0px;
	width:500pt;
	background-color:lightblue;
	
}

.prg-code {
	margin-left:0px;
	width:500pt;
	background-color:lightyellow;
	padding:10px;
	font-weight:bold;
}


.niceview {
	margin-left:0px;
	width:500pt;
	background-color:white;
	border-color:lightgray;
	border-width:1px;
	border-style:solid;
	padding:10px;
}

td
{
padding:3px;
}

table.dados
{

margin-left:0px;
width:53.5em;
border-collapse:collapse;
border:1px solid red;
text-align:center;


}

th
{
background-color:darkgreen;
color:yellow;
font-weight:bold;
text-transform:uppercase;
}
body
{
margin-left:60px;

</style>

<body><font color="black">
<hr>
<center><b style="font-size:1.5em;" >Curso completo de DarkGdk</b><br>
Gameprog - Escola de programação de jogos digitais<br>
Contato: gameprog.br@gmail.com<br>
<b>Fase 15.2</b></center>
<hr>
<table align="left" border="0" cellspacing="0" cellpadding="0" width="20%">
<tr><td><a href="darkgdk.html#start" style="color:blue"> index </a></td>
<td><a href="track15-1.html" style="color:blue">&lt;&lt;</a></td>
<td><a href="track15-3.html" style="color:blue">&gt;&gt;</a></td></tr></table><br><br>
<hr><a name="track01"></a><h3 style="background-color:#80ff80">15.2 Modelo 3D animado</h3><pre>

<b><u>1 Visão geral</b></u>
<img src="images\modeloAnimado.png">

De maneira geral, uma animação consiste de um conjunto de fotografias
ou quadros estáticos que são mostrados sequencialmente para produzir 
o efeito de animação. Geralmente a taxa de apresentação dos quadros
é dada em quadros por segundo ou <b>frames por segundo (fps)</b>. As taxas
mais populares são 24 e 30 quadros por segundo usadas no cinema e na 
televisão.

Em um modelo 3d os quadros não são fotos prontas mas sim configurações
matemáticas das transformações (rotação, movimento e escala) que o
objeto e suas partes apresentam nestes quadros. Naturalmente que o 
renderizador da DarkGdk pega estes "quadros de informações" e os 
transforma em imagens para se produzir a animação.

Em um modelo 3d é comum a presença de várias animações pré-configuradas
que podem ser acessadas e tocadas em ocasiões convenientes ao jogo.
Em nosso programa exemplo carregamos um soldado com um total de 136
quadros de animação, numerados de 0 a 135, abarcando animações de andar,
morrer, sofrer impacto, e posicionamento ocioso. Cada animação veio 
representada por um subconjunto de quadros que podem ser acessados
individualmente.

Há dois aspectos importantes que você deve controlar para ter objetos
bem animados no seu jogo: tempo e quadros. Naturalmente você vai ter
no seu programa um "relógio" e variáveis para mapear o tempo e os 
quadros a serem tocados.

<b><u>01.1 Tocando uma animação</b></u>
<b class=prg>// 0 - 50 Morrendo...
dbLoadObject ("H-German-Die.x",1);</b>
Como vimos na aula anterior, esta função carrega um modelo 3d. Este 
arquivo possui uma animação de 50 quadros com o personagem 'morrendo'.

Para tocar essa animação você usa a função <b class=prg>dbSetObjectFrame()</b> dentro
de um laço <b class=prg>for</b>. Esta função fixa o objeto no posicionamento dado pelo
quadro estabelecido. 

Exemplo: <b class=prg>
for (nFrame = 0; nFrame <= 50; nFrame++) dbSetObjectFrame (1, nFrame);</b>

O exemplo acima anima o objeto passando-o por todos os seus quadros
sequencialmente. Porém, essa animação não está correta pois nos modernos
computadores será apresentada violentamente rápida. É necessário adicionar
um timer para animar o objeto com a temporização adequada. Para isso você
vai usar a função <b class=prg>dbTimer()</b> dentro destes moldes:

<div class=niceview><b class=prg>
// Controle de tempo
int TempoFinal = 0;
int TempoInicial = 0;
int TempoDecorrido = 0;

// Controle de quadro 
// [111,136] Intervalo da animação caminhando
int nframe = 111;
int fr_inicial = 111;
int fr_final = 136;

TempoFinal = dbTimer();

// Verifica se passou 30ms para avançar o quadro
TempoDecorrido = TempoFinal - TempoInicial;
if (TempoDecorrido > 30) 
{
nframe = nframe + 1;
TempoInicial = dbTimer();
}   

// Se o frame for o último volte para o começo!
if (nframe >= fr_final) nframe = fr_inicial;

// Configura o quadro desejado
dbSetObjectFrame (1, nframe);
</b></div>
Em resumo você precisa medir o tempo decorrido entre um quadro e outro
e 'tocar' o próximo quadro dentro de um intervalo estabelecido. Este
intervalo pode ser diferente para os vários objetos em sua cena. Um
bom intervalo, testado no programa exemplo, é 30ms (microsegundos).

A função <b class=prg>dbTimer()</b> retorna um número inteiro que representa o relógio
do sistema dado em microsegundos. Um segundo é equivalente ao 1000 ms.

<b><u>01.2 Verificando o total de quadros de um objeto</b></u>
nframes = <b class=prg>dbTotalObjectFrames( nObj);</b>
Esta função retorna o número total de quadros que um modelo possui.

<b><u>01.3 Carregando várias animações</b></u>
<b class=sntx>dbAppendObject ( sFilename, nObj, nQuadroInicial);</b>
<b class=prg>dbAppendObject ("H-German-Attack1.x", 1, nQuadroInicial);</b>
A função <b class=prg>dbAppendObject()</b> adiciona as informações de animação do objeto
apontado  em  um  outro  objeto  existente.  Os  dois objetos devem ter
certamente a mesma geometria. Em nosso exemplo, as várias animações do 
soldado estão em arquivos separados e foram combinados em um só objeto.

Os argumentos dessa função são os seguintes:

      <b>sFilename</b> - nome do arquivo que contém o objeto para ser adicionado
           
	   <b>nObj</b> - Objeto que vai receber os dados de animação
		   
 <b>nQuadroInicial</b> - Define a partir de que quadro a animação adicionada
                  vai começar. Geralmente uma boa configuração para esta 
		  variável é o:
		  <b><u>total de quadros do objeto que está recebendo a animação + 1</u></b>.	

Veja agora o programa exemplo completo:	
<div class=prg-saida>
 <img src="images\modeloAnimado.png">
<br></div>
<div class=prg-code>

// modeloAnimado.cpp
// Esse programa ilustra como animar um modelo
</span><span class="sc9">#include "DarkGDK.h"
#include "windows.h"
</span><span class="sc0">
</span><span class="sc2">// Protótipo das funções
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">initsys</span><span class="sc10">();</span><span class="sc0">             </span><span class="sc2">// inicializa o sistema
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">teclado</span><span class="sc10">();</span><span class="sc0">             </span><span class="sc2">// Interpreta o teclado
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">texturizar</span><span class="sc10">();</span><span class="sc0">          </span><span class="sc2">// Texturiza a matrix
</span><span class="sc0">
</span><span class="sc2">// Rotação do objeto
</span><span class="sc16">float</span><span class="sc0"> </span><span class="sc11">xobj_rot</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">yobj_rot</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">zobj_rot</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> 

</span><span class="sc2">// Configuração dos modos. Vamos permitir rotacionar o objeto
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">modo</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">5</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">modo_obj_rot</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">5</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">terminar</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc2">// Controle de quadro
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">nframe</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">111</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">fr_inicial</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">111</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">fr_final</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">136</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc2">// Controle de tempo
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">TempoFinal</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">TempoInicial</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">TempoDecorrido</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc2">// ----------------------------------------------------------------------------
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">DarkGDK</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
</span><span class="sc2">//  Começo da aplicação DarkGdk 
</span><span class="sc0">
</span><span class="sc2">// Carrega modelo e fixa pasta de trabalho
</span><span class="sc11">dbSetWindowTitle</span>(<span class="sc6">"Aguarde..."</span>);<span>
</span><span class="sc11">dbLoadImage</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc6">"c:\\gameprog\\gdkmedia\\bitmap\\textura2x2.bmp"</span><span class="sc10">,</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">dbSetDir</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc6">"c:\\gameprog\\gdkmedia\\Modelos\\German"</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc2">// Carrega textura do soldado
</span><span class="sc11">dbLoadImage</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc6">"german.dds"</span><span class="sc10">,</span><span class="sc4">2</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc2">// 0 - 50 Morrendo...
</span><span class="sc11">dbLoadObject</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc6">"H-German-Die.x"</span><span class="sc10">,</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">nframes</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">TempoInicial</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">dbTimer</span><span class="sc10">();</span><span class="sc0">

</span><span class="sc2">// 51-75 Atirando....
</span><span class="sc11">nframes</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">dbTotalObjectFrames</span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">dbAppendObject</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc6">"H-German-Attack1.x"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">nframes</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc2">// 76-86 Impacto (Soldado sendo atingido)
</span><span class="sc11">nframes</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">dbTotalObjectFrames</span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">dbAppendObject</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc6">"H-German-Impact.x"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">nframes</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc2">// 87-110 Ocioso 
</span><span class="sc11">nframes</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">dbTotalObjectFrames</span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">dbAppendObject</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc6">"H-German-Idle.x"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">nframes</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc2">// 111-135 Caminhando 
</span><span class="sc11">nframes</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">dbTotalObjectFrames</span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">dbAppendObject</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc6">"H-German-Move.x"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">nframes</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc2">// Texturiza o soldado
</span><span class="sc11">dbTextureObject</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">,</span><span class="sc4">2</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc11">initsys</span><span class="sc10">();</span><span class="sc0"> 

</span><span class="sc2">// Faz o terreno do cenário
</span><span class="sc11">dbMakeMatrix</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">,</span><span class="sc4">2000</span><span class="sc10">,</span><span class="sc4">10000</span><span class="sc10">,</span><span class="sc4">10</span><span class="sc10">,</span><span class="sc4">50</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">dbPrepareMatrixTexture</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">,</span><span class="sc4">1</span><span class="sc10">,</span><span class="sc4">2</span><span class="sc10">,</span><span class="sc4">2</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">texturizar</span><span class="sc10">();</span><span class="sc0">

</span><span class="sc2">// Ajusta escala do objeto e ponto de apoio
</span><span class="sc11">dbScaleObject</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">,</span><span class="sc4">12000</span><span class="sc10">,</span><span class="sc4">12000</span><span class="sc10">,</span><span class="sc4">12000</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">dbFixObjectPivot</span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc2">// Ajusta câmera e posiciona objeto na cena
</span><span class="sc11">dbPositionCamera</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc4">1005</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">475</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">600</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">dbPositionObject</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">970</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">300</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">185</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc11">dbSyncOn</span><span class="sc10">();</span><span class="sc0">

</span><span class="sc2">// Looping principal
</span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc0"> </span><span class="sc11">LoopGDK</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc0"> </span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> 

</span><span class="sc11">TempoFinal</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">dbTimer</span><span class="sc10">();</span><span class="sc0">

</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">terminar</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">teclado</span><span class="sc10">();</span><span class="sc0">

</span><span class="sc11">dbSync</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc0"> </span><span class="sc10">);</span><span class="sc0">

</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">terminar</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
	</span><span class="sc11">dbDeleteImage</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">  </span><span class="sc11">dbDeleteMatrix</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0"> 
	</span><span class="sc11">dbDeleteObject</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
	</span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0"> </span><span class="sc2">// endif
</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc2">// fim do while
</span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0"> </span><span class="sc2">// fim da função: DarkGDK
</span><span class="sc0">
</span><span class="sc2">// ----------------------------------------------------------------------------
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">initsys</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">    
</span><span class="sc2">// Esta função inicializa o sistema
</span><span class="sc11">dbSyncOn</span><span class="sc10">(</span><span class="sc0"> </span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">dbSetWindowTitle</span><span class="sc10">(</span><span class="sc6">"modeloAnimado.cpp"</span><span class="sc10">);</span><span class="sc0"> 
</span><span class="sc11">dbDisableEscapeKey</span><span class="sc10">();</span><span class="sc0">
</span><span class="sc11">dbSyncRate</span><span class="sc10">(</span><span class="sc4">60</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">dbSetAmbientLight</span><span class="sc10">(</span><span class="sc4">100</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc10">}</span><span class="sc0"> </span><span class="sc2">// initsys().fim
</span><span class="sc0">

</span><span class="sc2">// ----------------------------------------------------------------------------
// texturizar() - Aplica aleatóriamente a textura na matrix
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">texturizar</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">linha</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">coluna</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">coluna</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">coluna</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">10</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">coluna</span><span class="sc10">++)</span><span class="sc0"> 
</span><span class="sc10">{</span><span class="sc0">
</span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">linha</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">linha</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">50</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">linha</span><span class="sc10">++)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
	</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">tile</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">dbRnd</span><span class="sc10">(</span><span class="sc4">4</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
	</span><span class="sc11">dbSetMatrixTile</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">coluna</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">linha</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">tile</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0"> </span><span class="sc2">// linha
</span><span class="sc10">}</span><span class="sc0"> </span><span class="sc2">//coluna
</span><span class="sc0">
</span><span class="sc11">dbUpdateMatrix</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc10">}</span><span class="sc0"> </span><span class="sc2">// texturizar().fim
</span><span class="sc0">

</span><span class="sc2">// ----------------------------------------------------------------------------
// teclado() - Lê o teclado e executa comandos do usuário
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">teclado</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">sinfo</span><span class="sc10">[</span><span class="sc4">255</span><span class="sc10">];</span><span class="sc0">

</span><span class="sc2">// Lê o teclado
</span><span class="sc0">    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">stecla</span><span class="sc10">=</span><span class="sc6">"??"</span><span class="sc10">;</span><span class="sc0">  
</span><span class="sc11">stecla</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">dbInKey</span><span class="sc10">();</span><span class="sc0">

</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">dbEscapeKey</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc11">terminar</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc2">// Mostre total de frames se tecla = 'p'
</span><span class="sc0">    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(!</span><span class="sc11">strcmp</span><span class="sc10">(</span><span class="sc11">stecla</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"p"</span><span class="sc10">))</span><span class="sc0"> 
</span><span class="sc10">{</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">nfram</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">dbTotalObjectFrames</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">sprintf</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">sinfo</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"total de frames: %d"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">nfram</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">dbSetWindowTitle</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">sinfo</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0"> </span><span class="sc2">// fim do if  
</span><span class="sc0">
</span><span class="sc2">// Morrer
</span><span class="sc0">    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(!</span><span class="sc11">strcmp</span><span class="sc10">(</span><span class="sc11">stecla</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"s"</span><span class="sc10">))</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">           
	</span><span class="sc11">fr_inicial</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
	</span><span class="sc11">fr_final</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">50</span><span class="sc10">;</span><span class="sc0">
	</span><span class="sc11">dbSetWindowTitle</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc6">"[00,50] Morrer - 's' "</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0"> </span><span class="sc2">// endif
</span><span class="sc0">
</span><span class="sc2">// Atirando...
</span><span class="sc0">    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(!</span><span class="sc11">strcmp</span><span class="sc10">(</span><span class="sc11">stecla</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"a"</span><span class="sc10">))</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
	</span><span class="sc2">// Atirar
</span><span class="sc0">        </span><span class="sc11">fr_inicial</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">51</span><span class="sc10">;</span><span class="sc0">
	</span><span class="sc11">fr_final</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">75</span><span class="sc10">;</span><span class="sc0">
	</span><span class="sc11">dbSetWindowTitle</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc6">"[51,75] Atirar - 'a' "</span><span class="sc10">);</span><span class="sc0">     
</span><span class="sc10">}</span><span class="sc0"> </span><span class="sc2">// endif
</span><span class="sc0">
</span><span class="sc2">// Levando tiro...
</span><span class="sc0">    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(!</span><span class="sc11">strcmp</span><span class="sc10">(</span><span class="sc11">stecla</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"z"</span><span class="sc10">))</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">       
	</span><span class="sc11">fr_inicial</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">76</span><span class="sc10">;</span><span class="sc0">
	</span><span class="sc11">fr_final</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">86</span><span class="sc10">;</span><span class="sc0">
	</span><span class="sc11">dbSetWindowTitle</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc6">"[76,86] Sendo atingido - 'z'"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0"> </span><span class="sc2">// endif
</span><span class="sc0">

</span><span class="sc2">// ocioso
</span><span class="sc0">    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(!</span><span class="sc11">strcmp</span><span class="sc10">(</span><span class="sc11">stecla</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"x"</span><span class="sc10">))</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">           
	</span><span class="sc11">fr_inicial</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">87</span><span class="sc10">;</span><span class="sc0">
	</span><span class="sc11">fr_final</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">110</span><span class="sc10">;</span><span class="sc0">
	</span><span class="sc11">dbSetWindowTitle</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc6">"[87,110] Ocioso - 'x'"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0"> </span><span class="sc2">// endif
</span><span class="sc0">

</span><span class="sc2">// ocioso
</span><span class="sc0">    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(!</span><span class="sc11">strcmp</span><span class="sc10">(</span><span class="sc11">stecla</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"d"</span><span class="sc10">))</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">       
	</span><span class="sc11">fr_inicial</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">111</span><span class="sc10">;</span><span class="sc0">
	</span><span class="sc11">fr_final</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">135</span><span class="sc10">;</span><span class="sc0">
	</span><span class="sc11">dbSetWindowTitle</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc6">"[111,135] Caminhando - 'd'"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0"> </span><span class="sc2">// endif
</span><span class="sc0">

</span><span class="sc2">// Rotação do soldado via teclado
</span><span class="sc0"></span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">dbUpKey</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc11">zobj_rot</span><span class="sc10">++;</span><span class="sc0">
</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">dbDownKey</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc11">zobj_rot</span><span class="sc10">--;</span><span class="sc0">
</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">dbLeftKey</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc11">xobj_rot</span><span class="sc10">--;</span><span class="sc0">
</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">dbRightKey</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc11">xobj_rot</span><span class="sc10">++;</span><span class="sc0">           
</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">dbKeyState</span><span class="sc10">(</span><span class="sc4">201</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc11">yobj_rot</span><span class="sc10">++;</span><span class="sc0">
</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">dbKeyState</span><span class="sc10">(</span><span class="sc4">209</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc11">yobj_rot</span><span class="sc10">--;</span><span class="sc0">            

</span><span class="sc2">// Mostra informações na tela  
</span><span class="sc0">   </span><span class="sc11">sprintf</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">sinfo</span><span class="sc10">,
</span><span class="sc0"> </span><span class="sc6">" s - morrer\n a - atirar\n z - atingido\n x - ocioso\n d - andar"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">dbText</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc4">10</span><span class="sc10">,</span><span class="sc4">30</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">sinfo</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">dbRotateObject</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">,</span><span class="sc11">xobj_rot</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">yobj_rot</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">zobj_rot</span><span class="sc10">);</span><span class="sc0">
  
</span><span class="sc2">// Resseta o teclado
</span><span class="sc0">    </span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">stecla</span><span class="sc10">,</span><span class="sc6">"??"</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc2">// Verifica se passou 30ms para avançar o quadro
</span><span class="sc0">    </span><span class="sc11">TempoDecorrido</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">TempoFinal</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">TempoInicial</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">TempoDecorrido</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">30</span><span class="sc10">)</span><span class="sc0"> 
</span><span class="sc10">{</span><span class="sc0">
</span><span class="sc11">nframe</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">nframe</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">TempoInicial</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">dbTimer</span><span class="sc10">();</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">   

</span><span class="sc2">// Se o frame for o último volte para o começo!
</span><span class="sc0">    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">nframe</span><span class="sc0"> </span><span class="sc10">&gt;=</span><span class="sc0"> </span><span class="sc11">fr_final</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">nframe</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">fr_inicial</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc2">// Configura o quadro desejado
</span><span class="sc0">    </span><span class="sc11">dbSetObjectFrame</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">nframe</span><span class="sc10">);</span><span class="sc0">
    
</span><span class="sc10">}</span><span class="sc0"> </span><span class="sc2">// teclado().fim</span></div>
<hr>
<table align="bottom" border="0" cellspacing="0" cellpadding="0" width="20%">
<tr><td><a href="darkgdk.html#start" style="color:blue"> index </a></td>
<td><a href="track15-1.html" style="color:blue">&lt;&lt;</a></td>
<td><a href="track15-3.html" style="color:blue">&gt;&gt;</a></td></tr></table><pre>
<hr>
<div style='background-color:lightyellow;color:blue'>
<center>Produzido por Gameprog: Jair Pereira - Setembro/2013 ©
gameprog.br@gmail.com
<a href='http://www.gameprog.com.br'>http://www.gameprog.com.br</a>
<a href='http://www.nucleoararat.com.br'>http://www.nucleoararat.com.br</a></center><hr></div></body></html>
