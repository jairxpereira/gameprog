<html><head>
<title>CVip_track20</title>
<style type="text/css">

.dica {	width:500pt; background:aliceblue;color:#700080}
span {
font-family: 'Courier New';
font-size: 10pt;
color: #000000;
}
.sc0 {
}


.sc1 {
color: darkgreen;
font-weight: bold;
}

.sntx {
color: darkgreen;
}


.sc2 {
color: #008000;
}
.sc4 {
color: #ff8000;
}
.sc5 {
font-weight: bold;
color: #0000FF;
}
.sc6 {
color: #FF0000;
}
.sc9 {
color: #804000;
font-weight: bold;
}
.sc10 {
font-weight: bold;
color: #000080;
}
.sc11 {
}
.sc16 {
color: #400080;
}

.prg {
color: #0000FF;
}

.prg-saida {

margin-left:0px;
width:500pt;
background-color:lightblue;

}

.prg-code {
margin-left:0px;
width:500pt;
background-color:lightyellow;
padding:10px;
font-weight:bold;
}


.niceview {
margin-left:0px;
width:500pt;
background-color:white;
border-color:lightgray;
border-width:1px;
border-style:solid;
padding:10px;
}

td
{
padding:3px;
}

table.dados
{

margin-left:0px;
width:53.5em;
border-collapse:collapse;
border:1px solid red;
text-align:center;
}

th
{
background-color:darkgreen;
color:yellow;
font-weight:bold;
text-transform:uppercase;
}
body
{
margin-left:60px;
}
.pagebody
{
margin-left:50px;
border-width:1px;
border-style:solid;
border-color:white;
background-color:white;
width:90%;
-webkit-border-radius: 40px 40px 40px 40px;
-moz-border-radius: 40px 40px 40px 40px;
border-radius: 15px 15px 15px 15px;
}
.mybody
{
margin-top:20pt;
margin-bottom:20pt;
margin-left:20pt;
margin-right:20pt;
/* border-width:1px; */
/* border-style:solid; */
border-color:lightgray;
background-image:url('backdrop.jpg');
}
</style>
</head>
<body class=mybody><font color="black">
<div class=pagebody>
<hr>
<center><b style="font-size:1.5em;" >Curso completo de linguagem C</b><br>
Gameprog - Escola de programação de jogos digitais<br>
Contato: gameprog.br@gmail.com<br>
<b>track20.html</b></center>
<hr>
<table align=bottom border=0 cellspacing=0 cellpadding=0 width=20%><tr>
<td><a href=cvip.html style='color:blue'> index </a></td>
<td><a href='track19.html'style='color:blue'>&lt;&lt;</a></td><td><a href='track21.html'style='color:blue'>&gt;&gt;</a></td></tr></table>
<hr><pre>
<a name="track18"></a><h3 style="background-color:#80ff80">20. Modificadores de acesso e armazenamento</h3>
<b style="background-color:lightgreen">20.1 Visão geral</b>
Na  linguagem  C  existem  algumas instruções que especificam como as
variáveis  e    funções   serão tratadas,  acessadas  e  armazenadas.

As instruções que vamos estudar neste capítulo são:
<b>
extern          volatile        register
auto            const           pascal
cdecl           static</b>

<b style="background-color:lightgreen">20.2 extern</b>

Geralmente  a  construção  de  um bom programa é  feita  em  módulos,
aonde  cada  módulo  contém  funções e variáveis  globais  e  locais.
As  variáveis  e    funções  globais  são  aquelas  que  poderão  ser
acessadas  por  todas  as  partes do programa. As variáveis e funções
locais  são  aquelas  apenas  para uso  particular  do  módulo  aonde
foram desenvolvidas.

Você  pode  dividir  seu  programa em vários arquivos.h e  arquivos.c
a  fim  de  uma  melhor organização do código geral ou de facilitar a
distribuição    das    tarefas  entre   os  membros  da  sua  equipe.

A instrução <b class=prg>extern</b> é usada quando você for usar funções  e  variáveis
que estão em outros arquivos .c e de cabeçalho.  Sua sintaxe de uso é
muito simples, pois ela simplesmente precede o  nome  das  variáveis,
ponteiros  e  funções  que  estão  em  outros  arquivos:
<b style="color:green">
extern declaração_de_função;
extern declaração_de_variável;</b><font color="darkblue">
extern char sNome[];
extern int nIdade;
extern void DoSomething(int x);</font>

Ao  se  deparar  com  a  chamada de uma função  o compilador  precisa
estar  ciente  dos  tipos  de  dados usados pelos  valores de entrada
e  saída  desta  função  pois  ele tem que reservar espaço para estes
dados  para  os  processos  da  função e depois que a função executou
seus  processos  este  espaço    reservado  deve  ser  restituído  ao
sistema.  Este  é  o  papel  básico que o protótipo das funções  e  a
declaração    prévia    das   variáveis  exerce  para  o  compilador.

Quando  você  for  usar  uma função ou uma variável presente em outro
arquivo  que  você  já  sabe que o compilador já se  deparou  com  as
respectivas    declarações    você  não  precisa  usar  <span class=prg>extern</span>,  é  o
que  acontece  quando  usamos <span class=prg>printf()</span> ou <span class=prg>system()</span> que são de módulos
externos.  No  entanto,  é  interessante você usar <span class=prg>extern</span> na situação
em  que  as  variáveis  e as funções são definidas pelo usuário, isso
deixa    o    código   mais  compreensível.  Porém,  <b class=prg>extern</b>  torna-se
obrigatório  quando  você  faz  uso  de  uma função ou variável cujas
declarações  somente  vão  aparecer nos arquivos que serão compilados
posteriormente.

<div class=prg-saida>
 <img src=images\mainpart.png>
<br></div>
<div class=prg-code>
<span class="sc1">/* Arquivo: modulo.h             */</span><span class="sc0">
</span><span class="sc1">/* Ilustra o uso de extern       */</span><span class="sc0">
</span><span class="sc1">/* parte do programa mainpart.c  */</span><span class="sc0">

</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">sNome</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"Variavel sNome[] do modulo.h"</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">sCidade</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"Sorocaba"</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">nIdade</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">33</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc1">/* ------------------ Função say()  ----------------------- */</span><span class="sc0">    
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">say</span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">sText</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
</span><span class="sc11">printf</span><span class="sc10">(</span><span class="sc6">" %s \n"</span><span class="sc10">,</span><span class="sc11">sText</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc1">/* ------------------ Função initSys()  -------------------- */</span><span class="sc0">
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">initSys</span><span class="sc10">(</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">title</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
</span><span class="sc1">/* Configura a janela */</span><span class="sc0">
</span><span class="sc11">system</span><span class="sc10">(</span><span class="sc11">title</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">system</span><span class="sc10">(</span><span class="sc6">"color F1"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">printf</span><span class="sc10">(</span><span class="sc6">"\n\n"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span></div>
<br>
<div class=prg-code>
<span class="sc1">/* Programa: mainpart.c */</span><span class="sc0">
</span><span class="sc1">/* Este programa ilustra o uso de extern */</span><span class="sc0">
</span><span class="sc9">#include "stdio.h"
#include "modulo.h"
</span><span class="sc0">
</span><span class="sc1">/* Variáveis e funções externas */</span><span class="sc0">
</span><span class="sc16">extern</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">sNome</span><span class="sc10">[];</span><span class="sc0">
</span><span class="sc16">extern</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">say</span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">sText</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc16">extern</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">initSys</span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">title</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">main</span><span class="sc10">(</span><span class="sc16">void</span><span class="sc10">)</span><span class="sc0">  </span><span class="sc10">{</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">sInfo</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"Impresso via say() funcao do modulo.h"</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc11">initSys</span><span class="sc10">(</span><span class="sc6">"title mainpart.c"</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc11">say</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">sInfo</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">say</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">sNome</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc11">printf</span><span class="sc10">(</span><span class="sc6">"\n Declarada noutro modulo, porem nao declarada com extern: \n"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">say</span><span class="sc10">(</span><span class="sc11">sCidade</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">printf</span><span class="sc10">(</span><span class="sc6">" idade: %i \n\n"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">nIdade</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc11">getchar</span><span class="sc10">();</span><span class="sc0">
</span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span></div>

<b style="background-color:lightgreen">20.3 static</b>

<u>static - PROTEGENDO VARIÁVEIS E FUNÇÕES DENTRO DO MÓDULO</u>
A instrução <b class=prg>static</b> tem  dois  propósitos.  No  seu  primeiro  efeito,
a instrução <span class=prg>static</span> é usada  na  declaração  de  variáveis  e  funções
para torná-los visíveis apenas dentro do módulo aonde são compiladas,
ou seja, funções ou variáveis que foram declaradas  como  <span class=prg>static</span>  não
terão seu conteúdo  acessado  em  módulos  externos  que  os  chamem.
<b style="color:green">
static declaração_de_função;
static declaração_de_variável;</b><font color="darkblue">
static char sNome[] = "Charles Webster Leadbeater";
static void say(char *sText);</font>

A instrução  <span class=prg>static</span>  usada dentro de funções para declarar variáveis
ocasiona um efeito diferente e muito útil que  vamos  tratar  abaixo.

<u>static - CONSERVANDO VALOR DE VARIÁVEIS ENTRE AS CHAMADAS</u>
Sabemos que as variáveis locais são as variáveis que  são  declaradas
dentro de uma função. Estas variáveis têm vida breve pois são criadas
no início do processo das funções e são destruídas  no  seu  término.

A  instrução  <span class=prg>static</span>  usada  na  declaração da variável dentro de uma
função permite  que  a variável seja mantida no término da função até
a  finalização  do  programa  principal.  Veja o programa exemplo que
ilustra isso:

<div class=prg-saida>
 <img src=images\static.png>
<br></div>
<div class=prg-code>
<span class="sc1">/* Programa: static.c - track 20      */</span><span class="sc0">
</span><span class="sc1">/* Testando static dentro das funções */</span><span class="sc0">
</span><span class="sc9">#include "stdio.h"
</span><span class="sc0">
</span><span class="sc1">/* ----- Protótipos ------ */</span><span class="sc0">
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">teste</span><span class="sc10">(</span><span class="sc16">void</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">initSys</span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">title</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">main</span><span class="sc10">(</span><span class="sc16">void</span><span class="sc10">)</span><span class="sc0">  
</span><span class="sc10">{</span><span class="sc0">

</span><span class="sc1">/* auto indica que a variável é local */</span><span class="sc0">
</span><span class="sc16">auto</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">ncx</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc11">initSys</span><span class="sc10">(</span><span class="sc6">"title static.c"</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">ncx</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc11">ncx</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">10</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">ncx</span><span class="sc10">++)</span><span class="sc0">
</span><span class="sc11">teste</span><span class="sc10">();</span><span class="sc0">

</span><span class="sc11">printf</span><span class="sc10">(</span><span class="sc6">"\n\n"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">getchar</span><span class="sc10">();</span><span class="sc0">
</span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;}</span><span class="sc0">

</span><span class="sc1">/* ------------------ Função teste()  ---------------------- */</span><span class="sc0">
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">teste</span><span class="sc10">(</span><span class="sc16">void</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
</span><span class="sc16">static</span><span class="sc0"> </span><span class="sc11">nValor</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">20</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">nValor</span><span class="sc10">++;</span><span class="sc0">
</span><span class="sc11">printf</span><span class="sc10">(</span><span class="sc6">" %d"</span><span class="sc10">,</span><span class="sc11">nValor</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc1">/* ------------------ Função initSys()  -------------------- */</span><span class="sc0">
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">initSys</span><span class="sc10">(</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">title</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
</span><span class="sc1">/* Configura a janela */</span><span class="sc0">
</span><span class="sc11">system</span><span class="sc10">(</span><span class="sc11">title</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">system</span><span class="sc10">(</span><span class="sc6">"color F1"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">printf</span><span class="sc10">(</span><span class="sc6">"\n\n"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0"></span></div>	

A  variável  estática  nValor  tem  o  seu  valor inicial igual a 20,
esta    inicialização    do    valor    somente    ocorre   uma  vez.
Veja  que  nas  chamadas  seguintes  a variável conservou o seu valor
entre  as  chamadas.  Há  um  processo, denominado recursividade,  no
qual  uma  função  chama  a  si mesma, aonde as  variáveis  estáticas
têm  outra  grande  utilidade.  Posteriormente,  vamos  estudar  este
processo.

<b style="background-color:lightgreen">20.4 const e volatile</b>

<u>const - IMPEDINDO MODIFICAÇÃO NAS VARIÁVEIS E PONTEIRO</u>
A  instrução  <b class=prg>const</b>  é  usada  para estabelecer uma variável como uma
constante,  isto  é,  seu  valor  não vai sofrer variações  durante o
programa.    Você    também    pode    usar    <b class=prg>const</b>  com  ponteiros.

A  principal  utilidade  de  <b class=prg>const</b> é evitar que outros processos para
os  quais  nós  passamos  nossas  variáveis  e  ponteiros  modifiquem
os seus  valores  e  endereços.
<b style="color:green">
const declaração_de_variável;</b><font color="darkblue">
const float PI = 3.141516;</font>

<u>Definindo ponteiros constantes</u><b style="color:green">
definição_de_tipo_de_ponteiro *const nomeptr = &var;</b><font color="darkblue">
const float PI = 3.141516;

float *const ptrpi = &PI;</font>
Nessa  declaração  de  um  ponteiro  constante  você  deve  passar de
imediato o endereço (&) da variável visto que  isto  não  poderá  ser
feito posteriormente.  Naturalmente você pode manipular o dado para o
qual o ponteiro aponta, porém você não consegue mais mudar o endereço
que o ponteiro representa.

<font color="darkblue">const float *ptrpi = &PI;</font>
Nesta  sintaxe  você  não  pode alterar o dado para o qual a variável
aponta.

<font color="darkblue">const float *const ptrpi = &PI;</font>
Nesta  sintaxe  você  não  pode alterar o dado para o qual a variável
aponta  nem  o  endereço.  É  inválido <span class=sc6>*ptrpi = 19; ou *ptrpi = &var;</span>

<u>volatile - DECLARANDO A VARIÁVEL COMO VOLÁTIL</u>
Ao  contrário  de  <span class=prg>const</span>,  a  instrução  <b class=prg>volatile</b>  deixa  claro que a
variável pode ter o  seu  conteúdo  alterado  por  outros  processos.
<b style="color:green">
volatile declaração_de_variável;</b><font color="darkblue">
volatile long nMinutos = 0;</font>

Um  uso  para  <b class=prg>volatile</b>  seria  usá-la para declarar uma variável que
teria o seu valor atualizado continuamente pelo relógio  do  sistema.

<b style="background-color:lightgreen">20.4 auto e register</b>

<u>auto - DEFININDO A VARIÁVEL COMO LOCAL</u>
A instrução <b class=prg>auto</b> estabelece que a variável é local.  Automaticamente,
toda variável declarada dentro de  uma  função  recebe  como  default
o  modificador <span class=prg>auto</span>.  Você não pode usar <span class=prg>auto</span> para declarar variáveis
globais,  aquelas  que  são  declaradas  antes da função <span class=prg>main()</span>, isto
ocasiona erro de compilação.
<b style="color:green">
auto declaração_de_variável;</b><font color="darkblue">
void teste(void) {
auto long nMinutos = 0;}</font>

<u>register - VARIÁVEL DE ALTA PRIORIDADE</u>
<b style="color:green">
register declaração_de_variável;</b><font color="darkblue">
register int nValor = 0;</font>

Os    microprocessadores    possuem  varíaveis  internas  denominadas
registradores,  que  ocupam  a  memória de  alta  velocidade  interna
do  processador.  O  uso  dos registradores  acelera  a  execução  de
qualquer  programa.  A  instrução register sugere que a variável seja
estocada  no  processador.  O número de registradores  é  reduzido  e
geralmente  o  próprio  compilador vai usá-los para seus processos de
forma  que  não   adianta  muito  usar  register  na  declaração  das
nossas    variáveis   porque  na  prática  isso  pouco  vai  ocorrer.

<b style="background-color:lightgreen">20.5 cdecl e pascal</b>

A  instrução  cdecl  é  uma abreviação de c-declaration,  declarações
do  c  em  bom  português. Ela precede o nome de variáveis e funções.

A  sua  utilidade não é muito para o programador comum, ela determina
que  as  regras de compilação seja  todas  do  padrão C,  isto  é,  o
nome  das  variáveis é case sensitive; e o  nome  das  funções  terão
seus  nomes  alterados, sofre  um  acréscimo  do  underline  em  seus
nomes: _função();

Esta  instrução  é  útil    para  quem  constrói  compiladores,  para
quem  programa  bibliotecas  de    funções  que  serão  usadas  entre
diversas  linguagens.  Em  resumo  ela  padroniza processos  internos
para  que  possa  haver  intercâmbio  entre as diferentes  linguagens
de  programação.

A instrução pascal tem a mesma  função que  cdecl,  com  a  diferença
de que ela estabelece  os padrões da linguagem  pascal.  A  instrução
pascal é útil para quem quer ampliar os recursos da linguagem Clipper
que  usa  as  convenções  da  linguagem  pascal.
<b style="color:green">
pascal declaração_de_função;
pascal declaração_de_variável;
cdecl declaração_de_função;
cdecl declaração_de_variável;</b><font color="darkblue">

cdecl char sNome[] = "Charles Webster Leadbeater";
cdecl void say(char *sText);</font>
<hr>
<table align=bottom border=0 cellspacing=0 cellpadding=0 width=20%><tr><td><a href=cvip.html style='color:blue'> index </a></td><td><a href='track19.html'style='color:blue'>&lt;&lt;</a></td><td><a href='track21.html'style='color:blue'>&gt;&gt;</a></td></tr></table><hr><div style='background-color:lightyellow;color:blue'>
<center>Produzido por Gameprog: Jair Pereira - Fev/2006 - Junho/2013 ©
gameprog.br@gmail.com
<a href='http://www.gameprog.com.br'>http://www.gameprog.com.br</a></center><hr></div></div></body></html>
